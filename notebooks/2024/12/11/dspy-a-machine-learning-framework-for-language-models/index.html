<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Explore the features and capabilities of DSPy, a comprehensive machine learning framework designed specifically for Language Models."><meta name=author content="Anas Rabhi"><link href=https://ianas.fr/notebooks/2024/12/11/dspy-a-machine-learning-framework-for-language-models/ rel=canonical><link href=../../../02/25/new-frameworks-of-generative-ai/ rel=prev><link rel=icon href=../../../../../assets/favicon.png><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.7.2"><title>DSPy, a machine learning framework for Language Models - Intelligence artificielle</title><link rel=stylesheet href=../../../../../assets/stylesheets/main.484c7ddc.min.css><link rel=stylesheet href=../../../../../assets/stylesheets/palette.ab4e12ef.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style><script>__md_scope=new URL("../../../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function e(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],e("js",new Date),e("config","G-03FZVX8L64"),document.addEventListener("DOMContentLoaded",(function(){document.forms.search&&document.forms.search.query.addEventListener("blur",(function(){this.value&&e("event","search",{search_term:this.value})}));document$.subscribe((function(){var t=document.forms.feedback;if(void 0!==t)for(var a of t.querySelectorAll("[type=submit]"))a.addEventListener("click",(function(a){a.preventDefault();var n=document.location.pathname,d=this.getAttribute("data-md-value");e("event","feedback",{page:n,data:d}),t.firstElementChild.disabled=!0;var r=t.querySelector(".md-feedback__note [data-md-value='"+d+"']");r&&(r.hidden=!1)})),t.hidden=!1})),location$.subscribe((function(t){e("config","G-03FZVX8L64",{page_path:t.pathname})}))}));var t=document.createElement("script");t.async=!0,t.src="https://www.googletagmanager.com/gtag/js?id=G-03FZVX8L64",document.getElementById("__analytics").insertAdjacentElement("afterEnd",t)}</script><script>"undefined"!=typeof __md_analytics&&__md_analytics()</script><script async src=https://heeya.fr/agent/577c3cbc-9eb8-4d64-86b3-f82c7548702b/embed.js data-agent-name=ianas></script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#what-is-dspy class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../../../../.. title="Intelligence artificielle" class="md-header__button md-logo" aria-label="Intelligence artificielle" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 89 89"> <path d=M3.136,17.387l0,42.932l42.932,21.467l-42.932,-64.399Z /> <path d=M21.91,8l42.933,64.398l-18.775,9.388l-42.932,-64.399l18.774,-9.387Z style="fill-opacity: 0.5"/> <path d=M67.535,17.387l-27.262,18.156l21.878,32.818l5.384,2.691l0,-53.665Z /> <path d=M67.535,17.387l0,53.666l18.774,-9.388l0,-53.665l-18.774,9.387Z style="fill-opacity: 0.25"/> </svg> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Intelligence artificielle </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> DSPy, a machine learning framework for Language Models </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media=(prefers-color-scheme) data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to light mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1M8 13h8v-2H8zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4a5 5 0 0 0 5-5 5 5 0 0 0-5-5"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=indigo data-md-color-accent=indigo aria-label="Switch to dark mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_2 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=black data-md-color-accent=indigo aria-label="Switch to system preference" type=radio name=__palette id=__palette_2> <label class="md-header__button md-icon" title="Switch to system preference" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5M7 15a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3"/></svg> </label> </form> <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../../../../.. class=md-tabs__link> Accueil </a> </li> <li class=md-tabs__item> <a href=../../../../../blog/ class=md-tabs__link> Blog </a> </li> <li class="md-tabs__item md-tabs__item--active"> <a href=../../../../ class=md-tabs__link> Notebooks </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation hidden> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../../../../.. title="Intelligence artificielle" class="md-nav__button md-logo" aria-label="Intelligence artificielle" data-md-component=logo> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 89 89"> <path d=M3.136,17.387l0,42.932l42.932,21.467l-42.932,-64.399Z /> <path d=M21.91,8l42.933,64.398l-18.775,9.388l-42.932,-64.399l18.774,-9.387Z style="fill-opacity: 0.5"/> <path d=M67.535,17.387l-27.262,18.156l21.878,32.818l5.384,2.691l0,-53.665Z /> <path d=M67.535,17.387l0,53.666l18.774,-9.388l0,-53.665l-18.774,9.387Z style="fill-opacity: 0.25"/> </svg> </a> Intelligence artificielle </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../.. class=md-nav__link> <span class=md-ellipsis> Accueil </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2> <div class="md-nav__link md-nav__container"> <a href=../../../../../blog/ class="md-nav__link "> <span class=md-ellipsis> Blog </span> </a> <label class="md-nav__link " for=__nav_2 id=__nav_2_label tabindex=0> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Blog </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_2> <label class=md-nav__link for=__nav_2_2 id=__nav_2_2_label tabindex=0> <span class=md-ellipsis> Archive </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2_2> <span class="md-nav__icon md-icon"></span> Archive </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../blog/archive/2026/ class=md-nav__link> <span class=md-ellipsis> 2026 </span> </a> </li> <li class=md-nav__item> <a href=../../../../../blog/archive/2025/ class=md-nav__link> <span class=md-ellipsis> 2025 </span> </a> </li> <li class=md-nav__item> <a href=../../../../../blog/archive/2024/ class=md-nav__link> <span class=md-ellipsis> 2024 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_2_3> <label class=md-nav__link for=__nav_2_3 id=__nav_2_3_label tabindex=0> <span class=md-ellipsis> Categories </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_2_3_label aria-expanded=false> <label class=md-nav__title for=__nav_2_3> <span class="md-nav__icon md-icon"></span> Categories </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../../blog/category/blog/ class=md-nav__link> <span class=md-ellipsis> Blog </span> </a> </li> <li class=md-nav__item> <a href=../../../../../blog/category/ia/ class=md-nav__link> <span class=md-ellipsis> IA </span> </a> </li> <li class=md-nav__item> <a href=../../../../../blog/category/llm/ class=md-nav__link> <span class=md-ellipsis> LLM </span> </a> </li> <li class=md-nav__item> <a href=../../../../../blog/category/rag/ class=md-nav__link> <span class=md-ellipsis> RAG </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3 checked> <div class="md-nav__link md-nav__container"> <a href=../../../../ class="md-nav__link "> <span class=md-ellipsis> Notebooks </span> </a> <label class="md-nav__link " for=__nav_3 id=__nav_3_label tabindex> <span class="md-nav__icon md-icon"></span> </label> </div> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=true> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Notebooks </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_2> <label class=md-nav__link for=__nav_3_2 id=__nav_3_2_label tabindex> <span class=md-ellipsis> Archive </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_2_label aria-expanded=false> <label class=md-nav__title for=__nav_3_2> <span class="md-nav__icon md-icon"></span> Archive </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../archive/2024/ class=md-nav__link> <span class=md-ellipsis> 2024 </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--section md-nav__item--nested"> <input class="md-nav__toggle md-toggle " type=checkbox id=__nav_3_3> <label class=md-nav__link for=__nav_3_3 id=__nav_3_3_label tabindex> <span class=md-ellipsis> Categories </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=2 aria-labelledby=__nav_3_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3_3> <span class="md-nav__icon md-icon"></span> Categories </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../../../category/ai/ class=md-nav__link> <span class=md-ellipsis> AI </span> </a> </li> <li class=md-nav__item> <a href=../../../../category/blog/ class=md-nav__link> <span class=md-ellipsis> Blog </span> </a> </li> <li class=md-nav__item> <a href=../../../../category/llm/ class=md-nav__link> <span class=md-ellipsis> LLM </span> </a> </li> </ul> </nav> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#what-is-dspy class=md-nav__link> <span class=md-ellipsis> What is DSPy ? </span> </a> </li> <li class=md-nav__item> <a href=#dspy-configuration class=md-nav__link> <span class=md-ellipsis> DSPy Configuration </span> </a> </li> <li class=md-nav__item> <a href=#signature-component class=md-nav__link> <span class=md-ellipsis> Signature component </span> </a> </li> <li class=md-nav__item> <a href=#module-component class=md-nav__link> <span class=md-ellipsis> Module component </span> </a> </li> <li class=md-nav__item> <a href=#metric-component class=md-nav__link> <span class=md-ellipsis> Metric component </span> </a> </li> <li class=md-nav__item> <a href=#optimizer-component class=md-nav__link> <span class=md-ellipsis> Optimizer component </span> </a> </li> </ul> </nav> </div> </div> </div> <div class="md-content md-content--post" data-md-component=content> <div class="md-sidebar md-sidebar--post" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class="md-sidebar__inner md-post"> <nav class="md-nav md-nav--primary"> <div class=md-post__back> <div class="md-nav__title md-nav__container"> <a href=../../../../ class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> <span class=md-ellipsis> Back to index </span> </a> </div> </div> <div class="md-post__authors md-typeset"> <div class="md-profile md-post__profile"> <span class="md-author md-author--long"> <img src=https://avatars.githubusercontent.com/anas-rabhi alt="Anas Rabhi"> </span> <span class=md-profile__description> <strong> <a href=https://www.linkedin.com/in/anasrabhi>Anas Rabhi</a> </strong> <br> Creator </span> </div> </div> <ul class="md-post__meta md-nav__list"> <li class="md-nav__item md-nav__item--section"> <div class=md-post__title> <span class=md-ellipsis> Metadata </span> </div> <nav class=md-nav> <ul class=md-nav__list> <li class=md-nav__item> <div class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 19H5V8h14m-3-7v2H8V1H6v2H5c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V5a2 2 0 0 0-2-2h-1V1m-1 11h-5v5h5z"/></svg> <time datetime="2024-12-11 00:00:00+00:00" class=md-ellipsis>11/12/2024</time> </div> </li> <li class=md-nav__item> <div class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9 3v15h3V3zm3 2 4 13 3-1-4-13zM5 5v13h3V5zM3 19v2h18v-2z"/></svg> <span class=md-ellipsis> in <a href=../../../../category/blog/ >Blog</a>, <a href=../../../../category/llm/ >LLM</a></span> </div> </li> <li class=md-nav__item> <div class=md-nav__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 20a8 8 0 0 0 8-8 8 8 0 0 0-8-8 8 8 0 0 0-8 8 8 8 0 0 0 8 8m0-18a10 10 0 0 1 10 10 10 10 0 0 1-10 10C6.47 22 2 17.5 2 12A10 10 0 0 1 12 2m.5 5v5.25l4.5 2.67-.75 1.23L11 13V7z"/></svg> <span class=md-ellipsis> 16 min read </span> </div> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <article class="md-content__inner md-typeset"> <h1>DSPy, a machine learning framework for Language Models</h1> <style>
.language-plaintext.highlighter-rouge {
    margin-left: 50px !important;
    --code-header-muted-color: remove;
    opacity: 80%;
    background: #8b8b8b00;
}
</style> <h2 id=what-is-dspy>What is DSPy ?<a class=headerlink href=#what-is-dspy title="Permanent link">&para;</a></h2> <p>A very quick description would be something like: building end-to-end Language Model (LM) applications by assembling various components without any prompt engineering... At least, that's one of the main purposes of this framework.</p> <p>DSPy is a machine learning (ML) framework created by the Stanford NLP community. Thus, it utilizes the same principles used in ML, including a training dataset, a model, a loss function, and an optimizer.</p> <p>So, what components can we assemble to create an LM/LLM app with DSPy ? - Signature Component: Allows explicit specification of the application's input and output. - Module Component: Contains a prompting technique with an already crafted prompt. - Metric Component: Allows specification of the loss function we want to minimize for a specific task/use case. - Optimizer Component: Contains various optimization techniques to optimize the prompt and other parameters.</p> <p>These components might not be easy to understand at first glance, especially the <strong>optimizer</strong>. So, let's dive in and see how each component works individually and how they operate once assembled.</p> <!-- more --> <p>Sources : - DSPy Paper : <a href=https://arxiv.org/abs/2310.03714>https://arxiv.org/abs/2310.03714</a> - DPSy Github/doc : <a href=https://github.com/stanfordnlp/dspy>https://github.com/stanfordnlp/dspy</a></p> <p>In this notebook, I'll be using <a href=https://microsoft.github.io/promptflow/how-to-guides/tracing/index.html>promptflow</a> to trace the language model calls and understand how DSPy interacts with the LM. We can also access the prompt using a method provided by DSPy (more details in the next section).</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a><span class=kn>from</span><span class=w> </span><span class=nn>promptflow.tracing</span><span class=w> </span><span class=kn>import</span> <span class=n>start_trace</span>
</span><span id=__span-0-2><a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a>
</span><span id=__span-0-3><a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a><span class=c1># Initialize the tracing</span>
</span><span id=__span-0-4><a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a><span class=n>start_trace</span><span class=p>()</span>
</span></code></pre></div> <div class="language-text highlight"><pre><span></span><code>Starting prompt flow service...
</code></pre></div> <h2 id=dspy-configuration>DSPy Configuration<a class=headerlink href=#dspy-configuration title="Permanent link">&para;</a></h2> <p>Before starting, it's necessary to set up the language model. DSPy offers several constructors for this purpose: - OpenAI - Bedrock - Cohere - OllamaLocal - ... </p> <p>See the documentation : <a href=https://dspy-docs.vercel.app/docs/building-blocks/language_models>here</a> </p> <div class="language-python highlight"><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=kn>import</span><span class=w> </span><span class=nn>dspy</span>
</span><span id=__span-1-2><a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a><span class=kn>import</span><span class=w> </span><span class=nn>os</span>
</span><span id=__span-1-3><a id=__codelineno-1-3 name=__codelineno-1-3 href=#__codelineno-1-3></a><span class=n>os</span><span class=o>.</span><span class=n>environ</span><span class=p>[</span><span class=s1>&#39;OPENAI_API_KEY&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=s2>&quot;sk-....&quot;</span>
</span><span id=__span-1-4><a id=__codelineno-1-4 name=__codelineno-1-4 href=#__codelineno-1-4></a>
</span><span id=__span-1-5><a id=__codelineno-1-5 name=__codelineno-1-5 href=#__codelineno-1-5></a><span class=c1># Call the OpenAI constructor</span>
</span><span id=__span-1-6><a id=__codelineno-1-6 name=__codelineno-1-6 href=#__codelineno-1-6></a><span class=n>gpt3_turbo</span> <span class=o>=</span> <span class=n>dspy</span><span class=o>.</span><span class=n>OpenAI</span><span class=p>(</span><span class=n>model</span><span class=o>=</span><span class=s1>&#39;gpt-3.5-turbo-1106&#39;</span><span class=p>,</span> <span class=n>max_tokens</span><span class=o>=</span><span class=mi>300</span><span class=p>,</span> <span class=n>temperature</span><span class=o>=</span><span class=mf>0.1</span><span class=p>)</span>
</span><span id=__span-1-7><a id=__codelineno-1-7 name=__codelineno-1-7 href=#__codelineno-1-7></a>
</span><span id=__span-1-8><a id=__codelineno-1-8 name=__codelineno-1-8 href=#__codelineno-1-8></a><span class=c1># Once the LLM is set up within the configuration, the entire DSPy pipeline will use the same model (unless it is manually changed).</span>
</span><span id=__span-1-9><a id=__codelineno-1-9 name=__codelineno-1-9 href=#__codelineno-1-9></a><span class=n>dspy</span><span class=o>.</span><span class=n>configure</span><span class=p>(</span><span class=n>lm</span><span class=o>=</span><span class=n>gpt3_turbo</span><span class=p>)</span>
</span></code></pre></div> <div class="language-python highlight"><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a><span class=c1># A one-off call to the model can also be made.</span>
</span><span id=__span-2-2><a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a><span class=nb>print</span><span class=p>(</span><span class=n>gpt3_turbo</span><span class=p>(</span><span class=s1>&#39;What is DSPy&#39;</span><span class=p>,</span> <span class=n>max_tokens</span><span class=o>=</span><span class=mi>10</span><span class=p>,</span> <span class=n>temperature</span><span class=o>=</span><span class=mi>0</span><span class=p>,</span> <span class=n>n</span><span class=o>=</span><span class=mi>2</span><span class=p>))</span>
</span></code></pre></div> <div class="language-text highlight"><pre><span></span><code>[&#39;DSPy is a Python library for digital signal processing&#39;,
 &#39;DSPy is a Python library for digital signal processing&#39;]
</code></pre></div> <div class="language-python highlight"><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a><span class=c1># One can access the prompt with the following command </span>
</span><span id=__span-3-2><a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a><span class=n>gpt3_turbo</span><span class=o>.</span><span class=n>inspect_history</span><span class=p>(</span><span class=n>n</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
</span><span id=__span-3-3><a id=__codelineno-3-3 name=__codelineno-3-3 href=#__codelineno-3-3></a>
</span><span id=__span-3-4><a id=__codelineno-3-4 name=__codelineno-3-4 href=#__codelineno-3-4></a><span class=c1># Outputs :</span>
</span></code></pre></div> <div class="language-text highlight"><pre><span></span><code>What is DSPy DSPy is a Python library for digital signal processing      (and 1 other completions)
</code></pre></div> <p>Above, those were the prompt and the answer of the LLM. Access is available via the <code>inspect_history</code> method.</p> <h2 id=signature-component>Signature component<a class=headerlink href=#signature-component title="Permanent link">&para;</a></h2> <p>For a given application, the signature specifies the input and output, and it needs to be explicit. For instance, for a translation task from English to French, the signature would resemble <code>"english_sentence -&gt; french_sentence"</code>, called an inline signature. The input text is in English, and the output is expected to be a French translation.</p> <p>The signature can be specified in two ways: - Inline: a signature written in a single line - Class-based: a signature defined within a class</p> <p>Here is an example of a "class-based" signature:</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-4-1><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=k>class</span><span class=w> </span><span class=nc>SentenceTranslation</span><span class=p>(</span><span class=n>dspy</span><span class=o>.</span><span class=n>Signature</span><span class=p>)</span> <span class=p>:</span>
</span><span id=__span-4-2><a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Translate an English sentence to French.&quot;&quot;&quot;</span>
</span><span id=__span-4-3><a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a>    <span class=n>english_sentence</span> <span class=o>=</span> <span class=n>dspy</span><span class=o>.</span><span class=n>InputField</span><span class=p>(</span><span class=n>desc</span><span class=o>=</span><span class=s2>&quot;English sentence to translate&quot;</span><span class=p>)</span>
</span><span id=__span-4-4><a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a>    <span class=n>french_sentence</span> <span class=o>=</span> <span class=n>dspy</span><span class=o>.</span><span class=n>OutputField</span><span class=p>(</span><span class=n>desc</span><span class=o>=</span><span class=s2>&quot;French sentence&quot;</span><span class=p>)</span>
</span></code></pre></div> <p>A class-based signature allows more customization. It's possible to add a docstring that describes the tasks (DSPy also considers the docstring when building the prompt), add multiple inputs and/or outputs, and include field descriptions (optional):</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-5-1><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=k>class</span><span class=w> </span><span class=nc>SentenceTranslation</span><span class=p>(</span><span class=n>dspy</span><span class=o>.</span><span class=n>Signature</span><span class=p>)</span> <span class=p>:</span>
</span><span id=__span-5-2><a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Translate an English sentence to French.&quot;&quot;&quot;</span>
</span><span id=__span-5-3><a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a>    <span class=n>english_sentence</span> <span class=o>=</span> <span class=n>dspy</span><span class=o>.</span><span class=n>InputField</span><span class=p>(</span><span class=n>desc</span><span class=o>=</span><span class=s2>&quot;English sentence to translate&quot;</span><span class=p>)</span>
</span><span id=__span-5-4><a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a>    <span class=n>english_sentence</span> <span class=o>=</span> <span class=n>dspy</span><span class=o>.</span><span class=n>OutputField</span><span class=p>()</span>
</span><span id=__span-5-5><a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a>    <span class=n>explanation_sentence</span> <span class=o>=</span> <span class=n>dspy</span><span class=o>.</span><span class=n>OutputField</span><span class=p>(</span><span class=n>desc</span><span class=o>=</span><span class=s2>&quot;The sentence explained in french&quot;</span><span class=p>)</span>
</span></code></pre></div> <p>The signature component alone serves no purpose. It must be combined with the module component, which contains a prompting technique.</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-6-1><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=c1># Inline signature </span>
</span><span id=__span-6-2><a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a><span class=n>signature</span> <span class=o>=</span> <span class=s2>&quot;english_sentence -&gt; french_sentence&quot;</span>
</span><span id=__span-6-3><a id=__codelineno-6-3 name=__codelineno-6-3 href=#__codelineno-6-3></a><span class=nb>print</span><span class=p>(</span><span class=s2>&quot;This is an inline signature : </span><span class=se>\n\n</span><span class=s2> &quot;</span><span class=p>,</span> <span class=n>signature</span><span class=p>)</span>
</span></code></pre></div> <div class="language-text highlight"><pre><span></span><code>This is an inline signature :

  english_sentence -&gt; french_sentence
</code></pre></div> <div class="language-python highlight"><pre><span></span><code><span id=__span-7-1><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a><span class=c1># Class-based signature</span>
</span><span id=__span-7-2><a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a><span class=k>class</span><span class=w> </span><span class=nc>SentenceTranslation</span><span class=p>(</span><span class=n>dspy</span><span class=o>.</span><span class=n>Signature</span><span class=p>)</span> <span class=p>:</span>
</span><span id=__span-7-3><a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Translate an English sentence to French.&quot;&quot;&quot;</span>
</span><span id=__span-7-4><a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a>    <span class=n>english_sentence</span> <span class=o>=</span> <span class=n>dspy</span><span class=o>.</span><span class=n>InputField</span><span class=p>(</span><span class=n>desc</span><span class=o>=</span><span class=s2>&quot;English sentence to translate&quot;</span><span class=p>)</span>
</span><span id=__span-7-5><a id=__codelineno-7-5 name=__codelineno-7-5 href=#__codelineno-7-5></a>    <span class=n>french_sentence</span> <span class=o>=</span> <span class=n>dspy</span><span class=o>.</span><span class=n>OutputField</span><span class=p>(</span><span class=n>desc</span><span class=o>=</span><span class=s2>&quot;French sentence&quot;</span><span class=p>)</span>
</span><span id=__span-7-6><a id=__codelineno-7-6 name=__codelineno-7-6 href=#__codelineno-7-6></a>    <span class=n>explanation_sentence</span> <span class=o>=</span> <span class=n>dspy</span><span class=o>.</span><span class=n>OutputField</span><span class=p>(</span><span class=n>desc</span><span class=o>=</span><span class=s2>&quot;The sentence explained in french&quot;</span><span class=p>)</span>
</span><span id=__span-7-7><a id=__codelineno-7-7 name=__codelineno-7-7 href=#__codelineno-7-7></a>
</span><span id=__span-7-8><a id=__codelineno-7-8 name=__codelineno-7-8 href=#__codelineno-7-8></a><span class=nb>print</span><span class=p>(</span><span class=s2>&quot;This is a class based signature : </span><span class=se>\n\n</span><span class=s2> &quot;</span><span class=p>,</span> <span class=n>SentenceTranslation</span><span class=p>)</span>
</span></code></pre></div> <div class="language-text highlight"><pre><span></span><code>This is a class based signature :

  SentenceTranslation(english_sentence -&gt; french_sentence, explanation_sentence
    instructions=&#39;Translate an English sentence to French.&#39;
    english_sentence = Field(annotation=str required=True json_schema_extra={&#39;desc&#39;: &#39;English sentence to translate&#39;, &#39;__dspy_field_type&#39;: &#39;input&#39;, &#39;prefix&#39;: &#39;English Sentence:&#39;})
    french_sentence = Field(annotation=str required=True json_schema_extra={&#39;desc&#39;: &#39;French sentence&#39;, &#39;__dspy_field_type&#39;: &#39;output&#39;, &#39;prefix&#39;: &#39;French Sentence:&#39;})
    explanation_sentence = Field(annotation=str required=True json_schema_extra={&#39;desc&#39;: &#39;The sentence explained in french&#39;, &#39;__dspy_field_type&#39;: &#39;output&#39;, &#39;prefix&#39;: &#39;Explanation Sentence:&#39;})
)
</code></pre></div> <h2 id=module-component>Module component<a class=headerlink href=#module-component title="Permanent link">&para;</a></h2> <p>Each module contains a generalized prompt (basic prompt, ChainOfThought prompt, etc.), and the signature is used to personalize this prompt. This component takes the signature as an input and outputs a personalized prompt with the signature fields.</p> <p>There are several prompting techniques (e.g., modules) to explore in DSPy. In this notebook, only two of them will be used to understand how DSPy works: - <code>dspy.Predict</code>: the fundamental one, which contains a basic prompting technique. - <code>dspy.ChainOfThought</code>: built using the <strong>Predict</strong> module, this technique teaches the LLM to think step by step. - All modules are available: <a href=https://dspy-docs.vercel.app/docs/building-blocks/modules#what-other-dspy-modules-are-there-how-can-i-use-them>here</a></p> <p>Let's test different modules using various signatures:</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-8-1><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class=c1># Define the translation signature</span>
</span><span id=__span-8-2><a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a><span class=n>translation_signature</span> <span class=o>=</span> <span class=s2>&quot;english_sentence -&gt; french_sentence&quot;</span>
</span><span id=__span-8-3><a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a>
</span><span id=__span-8-4><a id=__codelineno-8-4 name=__codelineno-8-4 href=#__codelineno-8-4></a><span class=c1># Define the question signature</span>
</span><span id=__span-8-5><a id=__codelineno-8-5 name=__codelineno-8-5 href=#__codelineno-8-5></a><span class=n>question_signature</span> <span class=o>=</span> <span class=s2>&quot;question -&gt; answer&quot;</span>
</span></code></pre></div> <div class="language-python highlight"><pre><span></span><code><span id=__span-9-1><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a><span class=c1># Let&#39;s instantiate the module for each signature</span>
</span><span id=__span-9-2><a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a>
</span><span id=__span-9-3><a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a><span class=c1># Translation program</span>
</span><span id=__span-9-4><a id=__codelineno-9-4 name=__codelineno-9-4 href=#__codelineno-9-4></a><span class=n>translate</span> <span class=o>=</span> <span class=n>dspy</span><span class=o>.</span><span class=n>Predict</span><span class=p>(</span><span class=n>translation_signature</span><span class=p>)</span>
</span><span id=__span-9-5><a id=__codelineno-9-5 name=__codelineno-9-5 href=#__codelineno-9-5></a>
</span><span id=__span-9-6><a id=__codelineno-9-6 name=__codelineno-9-6 href=#__codelineno-9-6></a><span class=c1># Question-answer program</span>
</span><span id=__span-9-7><a id=__codelineno-9-7 name=__codelineno-9-7 href=#__codelineno-9-7></a><span class=n>answer</span> <span class=o>=</span> <span class=n>dspy</span><span class=o>.</span><span class=n>Predict</span><span class=p>(</span><span class=n>question_signature</span><span class=p>)</span>
</span></code></pre></div> <div class="language-python highlight"><pre><span></span><code><span id=__span-10-1><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a><span class=c1># Call the translation module using the appropriate input that matches the signature input name: english_sentence.</span>
</span><span id=__span-10-2><a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a><span class=n>translate</span><span class=p>(</span><span class=n>english_sentence</span><span class=o>=</span><span class=s2>&quot;Who is the best football player in the world?&quot;</span><span class=p>)</span>
</span></code></pre></div> <div class="language-text highlight"><pre><span></span><code>Prediction(
    french_sentence=&#39;Who is the best football player in the world? \nQui est le meilleur joueur de football du monde?&#39;
)
</code></pre></div> <p>The answer is correct. The prompt that DSPy sends to the language model appears as follows:</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-11-1><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a><span class=n>prompt</span> <span class=o>=</span> <span class=s2>&quot;&quot;&quot;Given the fields `english_sentence`, produce the fields `french_sentence`. --- Follow the following format. English Sentence: $</span><span class=si>{english_sentence}</span><span class=s2> French Sentence: $</span><span class=si>{french_sentence}</span><span class=s2> --- English Sentence: Who is the best football player in the world ? French Sentence:&quot;&quot;&quot;</span>
</span></code></pre></div> <p>DSPy adapted a basic prompt utilizing the translation signature. For instance, the input field that refers to the input detailed in the signature (<code>english_sentence</code>) came into use three times within the prompt, aiding the LM in comprehending the task: - « Given the fields <code>english_sentence</code> » : Included in the prompt without undergoing any transformation. - « following format. <code>English Sentence</code> » : Transformed and inserted into the prompt (removed the "_" and added uppercases) - « ${<code>english_sentence</code>} » : Inserted into the prompt without any transformation</p> <p>Let's consider the question-answer program : </p> <div class="language-python highlight"><pre><span></span><code><span id=__span-12-1><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a><span class=c1># The question-answer module must be called using the correct input matching the signature input name: question.</span>
</span><span id=__span-12-2><a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a><span class=n>answer</span><span class=p>(</span><span class=n>question</span><span class=o>=</span><span class=s2>&quot;Who is the best football player in the world ?&quot;</span><span class=p>)</span>
</span></code></pre></div> <div class="language-text highlight"><pre><span></span><code>Prediction(
    answer=&#39;Question: Who is the best football player in the world ?\nAnswer: It is subjective and depends on personal opinion, but some popular choices include Lionel Messi, Cristiano Ronaldo, and Neymar.&#39;
)
</code></pre></div> <p>The response is acceptable, but the LLM rewrites the question within the response. Let's take a look at the prompt sent by DSPy program:</p> <p><div class="language-python highlight"><pre><span></span><code><span id=__span-13-1><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a><span class=n>prompt</span> <span class=o>=</span> <span class=s2>&quot;&quot;&quot;Given the fields `question`, produce the fields `answer`. --- Follow the following format. Question: $</span><span class=si>{question}</span><span class=s2> Answer: $</span><span class=si>{answer}</span><span class=s2> --- Question: Who is the best football player in the world ? Answer:&quot;&quot;&quot;</span>
</span></code></pre></div> Once more, the prompt got formatted and adapted to fit the question-answer signature.</p> <p>Given that the LLM rewrites the question, perhaps this question-answer program wasn't sufficient. Improving the signature or experimenting with a different prompting technique (i.e., changing the module) might enhance performance. Let's try a class-based signature and add some information about the fields.</p> <p>Several elements can be customized in a class-based signature: - The docstring: offers a clear description of the task - The input fields: offers one or more input fields - The output fields: offers one or more output fields</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-14-1><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a><span class=k>class</span><span class=w> </span><span class=nc>QuestionAnswer</span><span class=p>(</span><span class=n>dspy</span><span class=o>.</span><span class=n>Signature</span><span class=p>)</span> <span class=p>:</span>
</span><span id=__span-14-2><a id=__codelineno-14-2 name=__codelineno-14-2 href=#__codelineno-14-2></a>    <span class=n>question</span> <span class=o>=</span> <span class=n>dspy</span><span class=o>.</span><span class=n>InputField</span><span class=p>(</span><span class=n>desc</span><span class=o>=</span><span class=s2>&quot;User question to be answered&quot;</span><span class=p>)</span> 
</span><span id=__span-14-3><a id=__codelineno-14-3 name=__codelineno-14-3 href=#__codelineno-14-3></a>    <span class=n>answer</span> <span class=o>=</span> <span class=n>dspy</span><span class=o>.</span><span class=n>OutputField</span><span class=p>(</span><span class=n>desc</span><span class=o>=</span><span class=s2>&quot;The answer to the user question&quot;</span><span class=p>)</span>
</span><span id=__span-14-4><a id=__codelineno-14-4 name=__codelineno-14-4 href=#__codelineno-14-4></a>
</span><span id=__span-14-5><a id=__codelineno-14-5 name=__codelineno-14-5 href=#__codelineno-14-5></a><span class=nb>print</span><span class=p>(</span><span class=s2>&quot;This is a class based signature : </span><span class=se>\n\n</span><span class=s2> &quot;</span><span class=p>,</span> <span class=n>QuestionAnswer</span><span class=p>)</span>
</span></code></pre></div> <div class="language-text highlight"><pre><span></span><code>This is a class based signature :

  QuestionAnswer(question -&gt; answer
    instructions=&#39;Given the fields `question`, produce the fields `answer`.&#39;
    question = Field(annotation=str required=True json_schema_extra={&#39;desc&#39;: &#39;User question to be answered&#39;, &#39;__dspy_field_type&#39;: &#39;input&#39;, &#39;prefix&#39;: &#39;Question:&#39;})
    answer = Field(annotation=str required=True json_schema_extra={&#39;desc&#39;: &#39;The answer to the user question&#39;, &#39;__dspy_field_type&#39;: &#39;output&#39;, &#39;prefix&#39;: &#39;Answer:&#39;})
)
</code></pre></div> <p>Let's take a look at how the module processes this class-based signature and whether it enhances this basic question-answer pipeline.</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-15-1><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a><span class=n>answer_improved</span> <span class=o>=</span> <span class=n>dspy</span><span class=o>.</span><span class=n>Predict</span><span class=p>(</span><span class=n>QuestionAnswer</span><span class=p>)</span> <span class=c1># We instantiate the module with the class based signature </span>
</span></code></pre></div> <div class="language-python highlight"><pre><span></span><code><span id=__span-16-1><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a><span class=n>answer_improved</span><span class=p>(</span><span class=n>question</span><span class=o>=</span><span class=s2>&quot;Who is the best football player in the world?&quot;</span><span class=p>)</span>
</span></code></pre></div> <div class="language-text highlight"><pre><span></span><code>Prediction(
    answer=&#39;It is subjective and depends on personal opinion, but some popular choices for the best football player in the world include Lionel Messi, Cristiano Ronaldo, and Neymar.&#39;
)
</code></pre></div> <p>Given that the class-based signature offers more customization options, the answer has seen an improvement. Let's take a look how this new signature changed the prompt sent to the LLM : </p> <div class="language-python highlight"><pre><span></span><code><span id=__span-17-1><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a><span class=n>prompt</span> <span class=o>=</span> <span class=s2>&quot;&quot;&quot;Question answer assistant. --- Follow the following format. Question: User question to be answered Answer: The answer to the user question --- Question: Who is the best football player in the world ? Answer:&quot;&quot;&quot;</span>
</span></code></pre></div> <p>A few new aspects can be observed: - The class's docstring appears at the beginning of the prompt (note that the usage of the docstring is optional). - The descriptions of the input and output fields are included within the prompt.</p> <p>Transitioning from a generic prompt to a more personalized one was made possible thanks to the class-based signature. </p> <p>Instead of using this class-based signature, let's consider combining an inline signature with a ChainOfThought module:</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-18-1><a id=__codelineno-18-1 name=__codelineno-18-1 href=#__codelineno-18-1></a><span class=n>answer_cot</span> <span class=o>=</span> <span class=n>dspy</span><span class=o>.</span><span class=n>ChainOfThought</span><span class=p>(</span><span class=s2>&quot;question -&gt; answer&quot;</span><span class=p>)</span> <span class=c1># We instantiate the module COT with the inline signature </span>
</span><span id=__span-18-2><a id=__codelineno-18-2 name=__codelineno-18-2 href=#__codelineno-18-2></a>
</span><span id=__span-18-3><a id=__codelineno-18-3 name=__codelineno-18-3 href=#__codelineno-18-3></a><span class=c1># We call our COT module with the right input that matches the signature input name : question</span>
</span><span id=__span-18-4><a id=__codelineno-18-4 name=__codelineno-18-4 href=#__codelineno-18-4></a><span class=n>answer_cot</span><span class=p>(</span><span class=n>question</span><span class=o>=</span><span class=s2>&quot;Who is the best football player in the world?&quot;</span><span class=p>)</span>
</span></code></pre></div> <div class="language-text highlight"><pre><span></span><code>Prediction(
    rationale=&#39;determine the best football player in the world. We can consider factors such as skill, performance, and impact on the game.&#39;,
    answer=&#39;The best football player in the world is subjective and can vary depending on individual opinions. Some may argue that Lionel Messi or Cristiano Ronaldo hold this title, while others may have different opinions.&#39;
)
</code></pre></div> <p>This new prompting technique enhanced the response. It also introduced a new field, <code>rationale</code>, where the LLM attempts to construct logical reasoning steps to answer the provided question. </p> <p>Let's take a look at the chain of thought prompt: <div class="language-python highlight"><pre><span></span><code><span id=__span-19-1><a id=__codelineno-19-1 name=__codelineno-19-1 href=#__codelineno-19-1></a><span class=n>prompt</span> <span class=o>=</span> <span class=s2>&quot;&quot;&quot;Given the fields `question`, produce the fields `answer`. --- Follow the following format. Question: $</span><span class=si>{question}</span><span class=s2> Reasoning: Let&#39;s think step by step in order to ${produce the answer}. We ... Answer: $</span><span class=si>{answer}</span><span class=s2> --- Question: Who is the best football player in the world? Reasoning: Let&#39;s think step by step in order to&quot;&quot;&quot;</span>
</span></code></pre></div></p> <p>This new module changed the prompt to employ the chain of thought technique for answering the question. Previously, with the basic prompt technique, there was a question and an answer. Now, there is a question, reasoning, and then the answer. In general, the Chain of Thought (COT) technique generally enhances the LLM's capability to execute complex reasoning (<a href=https://arxiv.org/pdf/2201.11903>paper</a>).</p> <p>To summarize what has been explored thus far about DSPy: - A signature component that facilitates the task definition - A module component that contains a prompting technique - The signature gets combined with the module component to create a DSPy program.</p> <p>The next step is about how the prompt can be optimized. To achieve this, let's explore the metric component.</p> <h2 id=metric-component>Metric component<a class=headerlink href=#metric-component title="Permanent link">&para;</a></h2> <p>As with any machine learning model, it's essential to define a metric to assess the model's performance and optimize the parameters. Naturally, considering that this involves LLMs, the metric might vary depending on the task at hand.</p> <p>Consider the following example: The goal is to build an app with DSPy to answer logical problems where the answer is either an integer or a float.</p> <p>The dataset will look something like this: <div class="language-python highlight"><pre><span></span><code><span id=__span-20-1><a id=__codelineno-20-1 name=__codelineno-20-1 href=#__codelineno-20-1></a><span class=n>problem</span> <span class=o>=</span> <span class=s2>&quot;If it takes 5 machines 5 minutes to make 5 widgets, how long would it take 100 machines to make 100 widgets?&quot;</span>
</span><span id=__span-20-2><a id=__codelineno-20-2 name=__codelineno-20-2 href=#__codelineno-20-2></a><span class=n>Answer</span> <span class=o>=</span> <span class=s2>&quot;5&quot;</span>
</span></code></pre></div></p> <div class="language-python highlight"><pre><span></span><code><span id=__span-21-1><a id=__codelineno-21-1 name=__codelineno-21-1 href=#__codelineno-21-1></a><span class=n>data</span> <span class=o>=</span> <span class=p>[</span>
</span><span id=__span-21-2><a id=__codelineno-21-2 name=__codelineno-21-2 href=#__codelineno-21-2></a>    <span class=n>dspy</span><span class=o>.</span><span class=n>Example</span><span class=p>(</span><span class=n>question</span><span class=o>=</span><span class=s2>&quot;If there are 12 fish and half of them drown, how many are left?&quot;</span><span class=p>,</span> <span class=n>answer</span><span class=o>=</span><span class=s2>&quot;12&quot;</span><span class=p>),</span>
</span><span id=__span-21-3><a id=__codelineno-21-3 name=__codelineno-21-3 href=#__codelineno-21-3></a>    <span class=n>dspy</span><span class=o>.</span><span class=n>Example</span><span class=p>(</span><span class=n>question</span><span class=o>=</span><span class=s2>&quot;A farmer has 17 sheep, and all but 9 die. How many are left?&quot;</span><span class=p>,</span> <span class=n>answer</span><span class=o>=</span><span class=s2>&quot;9&quot;</span><span class=p>),</span>
</span><span id=__span-21-4><a id=__codelineno-21-4 name=__codelineno-21-4 href=#__codelineno-21-4></a>    <span class=n>dspy</span><span class=o>.</span><span class=n>Example</span><span class=p>(</span><span class=n>question</span><span class=o>=</span><span class=s2>&quot;If you toss a coin 3 times, how many different possible outcomes are there?&quot;</span><span class=p>,</span> <span class=n>answer</span><span class=o>=</span><span class=s2>&quot;8&quot;</span><span class=p>),</span>
</span><span id=__span-21-5><a id=__codelineno-21-5 name=__codelineno-21-5 href=#__codelineno-21-5></a>    <span class=n>dspy</span><span class=o>.</span><span class=n>Example</span><span class=p>(</span><span class=n>question</span><span class=o>=</span><span class=s2>&quot;If a doctor gives you 4 pills and tells you to take one pill every half hour, how long would the pills last?&quot;</span><span class=p>,</span> <span class=n>answer</span><span class=o>=</span><span class=s2>&quot;2&quot;</span><span class=p>),</span>
</span><span id=__span-21-6><a id=__codelineno-21-6 name=__codelineno-21-6 href=#__codelineno-21-6></a>    <span class=n>dspy</span><span class=o>.</span><span class=n>Example</span><span class=p>(</span><span class=n>question</span><span class=o>=</span><span class=s2>&quot;How many times does the digit 5 appear in the numbers from 1 to 100?&quot;</span><span class=p>,</span> <span class=n>answer</span><span class=o>=</span><span class=s2>&quot;20&quot;</span><span class=p>),</span>
</span><span id=__span-21-7><a id=__codelineno-21-7 name=__codelineno-21-7 href=#__codelineno-21-7></a>    <span class=n>dspy</span><span class=o>.</span><span class=n>Example</span><span class=p>(</span><span class=n>question</span><span class=o>=</span><span class=s2>&quot;How many times can you subtract 5 from 25?&quot;</span><span class=p>,</span> <span class=n>answer</span><span class=o>=</span><span class=s2>&quot;5&quot;</span><span class=p>),</span>
</span><span id=__span-21-8><a id=__codelineno-21-8 name=__codelineno-21-8 href=#__codelineno-21-8></a>    <span class=n>dspy</span><span class=o>.</span><span class=n>Example</span><span class=p>(</span><span class=n>question</span><span class=o>=</span><span class=s2>&quot;If it takes 5 machines 5 minutes to make 5 widgets, how long would it take 100 machines to make 100 widgets?&quot;</span><span class=p>,</span> <span class=n>answer</span><span class=o>=</span><span class=s2>&quot;5&quot;</span><span class=p>),</span>
</span><span id=__span-21-9><a id=__codelineno-21-9 name=__codelineno-21-9 href=#__codelineno-21-9></a>    <span class=n>dspy</span><span class=o>.</span><span class=n>Example</span><span class=p>(</span><span class=n>question</span><span class=o>=</span><span class=s2>&quot;How many months have 28 days?&quot;</span><span class=p>,</span> <span class=n>answer</span><span class=o>=</span><span class=s2>&quot;12&quot;</span><span class=p>),</span>
</span><span id=__span-21-10><a id=__codelineno-21-10 name=__codelineno-21-10 href=#__codelineno-21-10></a>    <span class=n>dspy</span><span class=o>.</span><span class=n>Example</span><span class=p>(</span><span class=n>question</span><span class=o>=</span><span class=s2>&quot;If you want to have twelve apples and you already have some apples, how many apples do you need if you already have 9?&quot;</span><span class=p>,</span> <span class=n>answer</span><span class=o>=</span><span class=s2>&quot;3&quot;</span><span class=p>),</span>
</span><span id=__span-21-11><a id=__codelineno-21-11 name=__codelineno-21-11 href=#__codelineno-21-11></a>    <span class=n>dspy</span><span class=o>.</span><span class=n>Example</span><span class=p>(</span><span class=n>question</span><span class=o>=</span><span class=s2>&quot;What is the smallest number of chairs you need around a table to seat one person on each side, one at each end and one in the middle?&quot;</span><span class=p>,</span> <span class=n>answer</span><span class=o>=</span><span class=s2>&quot;5&quot;</span><span class=p>),</span>
</span><span id=__span-21-12><a id=__codelineno-21-12 name=__codelineno-21-12 href=#__codelineno-21-12></a>    <span class=n>dspy</span><span class=o>.</span><span class=n>Example</span><span class=p>(</span><span class=n>question</span><span class=o>=</span><span class=s2>&quot;You see a house with two doors One door leads to certain death and the other to freedom. There are two guards, one in front of each door. One guard always tells the truth, the other always lies. You do not know which guard is which, nor which door leads to freedom. You can ask only one question to one of the guards. How many questions you need to find the door to freedom?&quot;</span><span class=p>,</span> <span class=n>answer</span><span class=o>=</span><span class=s2>&quot;1&quot;</span><span class=p>),</span>
</span><span id=__span-21-13><a id=__codelineno-21-13 name=__codelineno-21-13 href=#__codelineno-21-13></a>    <span class=n>dspy</span><span class=o>.</span><span class=n>Example</span><span class=p>(</span><span class=n>question</span><span class=o>=</span><span class=s2>&quot;When Chris was 6 years old his sister was half his age. Now chris is 20 how old his sister is now ?&quot;</span><span class=p>,</span> <span class=n>answer</span><span class=o>=</span><span class=s2>&quot;17&quot;</span><span class=p>),</span>
</span><span id=__span-21-14><a id=__codelineno-21-14 name=__codelineno-21-14 href=#__codelineno-21-14></a><span class=p>]</span>
</span><span id=__span-21-15><a id=__codelineno-21-15 name=__codelineno-21-15 href=#__codelineno-21-15></a>
</span><span id=__span-21-16><a id=__codelineno-21-16 name=__codelineno-21-16 href=#__codelineno-21-16></a><span class=c1># The data is separated into a training and a test dataset</span>
</span><span id=__span-21-17><a id=__codelineno-21-17 name=__codelineno-21-17 href=#__codelineno-21-17></a><span class=n>train_dataset</span> <span class=o>=</span> <span class=p>[</span><span class=n>x</span><span class=o>.</span><span class=n>with_inputs</span><span class=p>(</span><span class=s1>&#39;question&#39;</span><span class=p>)</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=n>data</span><span class=p>[:</span><span class=mi>6</span><span class=p>]]</span>
</span><span id=__span-21-18><a id=__codelineno-21-18 name=__codelineno-21-18 href=#__codelineno-21-18></a><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;Training set size:&#39;</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>train_dataset</span><span class=p>))</span>
</span><span id=__span-21-19><a id=__codelineno-21-19 name=__codelineno-21-19 href=#__codelineno-21-19></a>
</span><span id=__span-21-20><a id=__codelineno-21-20 name=__codelineno-21-20 href=#__codelineno-21-20></a><span class=n>test_dataset</span> <span class=o>=</span> <span class=p>[</span><span class=n>x</span><span class=o>.</span><span class=n>with_inputs</span><span class=p>(</span><span class=s1>&#39;question&#39;</span><span class=p>)</span> <span class=k>for</span> <span class=n>x</span> <span class=ow>in</span> <span class=n>data</span><span class=p>[</span><span class=mi>6</span><span class=p>:]]</span>
</span><span id=__span-21-21><a id=__codelineno-21-21 name=__codelineno-21-21 href=#__codelineno-21-21></a><span class=nb>print</span><span class=p>(</span><span class=s1>&#39;Testing set size: &#39;</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=n>test_dataset</span><span class=p>))</span>
</span></code></pre></div> <div class="language-text highlight"><pre><span></span><code>Training set size: 6
Testing set size:  6
</code></pre></div> <p>Many metrics exist, but let's focus on the following one:</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-22-1><a id=__codelineno-22-1 name=__codelineno-22-1 href=#__codelineno-22-1></a><span class=k>def</span><span class=w> </span><span class=nf>answer_exact_match</span><span class=p>(</span><span class=n>real_value</span><span class=p>,</span> <span class=n>predicted_value</span><span class=p>):</span>
</span><span id=__span-22-2><a id=__codelineno-22-2 name=__codelineno-22-2 href=#__codelineno-22-2></a><span class=w>    </span><span class=sd>&quot;&quot;&quot;Exact match function to evaluate the model.&quot;&quot;&quot;</span>
</span><span id=__span-22-3><a id=__codelineno-22-3 name=__codelineno-22-3 href=#__codelineno-22-3></a>    <span class=k>try</span><span class=p>:</span>
</span><span id=__span-22-4><a id=__codelineno-22-4 name=__codelineno-22-4 href=#__codelineno-22-4></a>        <span class=k>return</span> <span class=n>real_value</span> <span class=o>==</span> <span class=n>predicted_value</span>
</span><span id=__span-22-5><a id=__codelineno-22-5 name=__codelineno-22-5 href=#__codelineno-22-5></a>    <span class=k>except</span><span class=p>:</span>
</span><span id=__span-22-6><a id=__codelineno-22-6 name=__codelineno-22-6 href=#__codelineno-22-6></a>        <span class=k>return</span> <span class=kc>False</span>
</span></code></pre></div> <p>The output equals True when the response aligns with the predicted answer.</p> <p>So, let's apply a ChainOfThought question-answer DSPy pipeline and evaluate the answers : </p> <div class="language-python highlight"><pre><span></span><code><span id=__span-23-1><a id=__codelineno-23-1 name=__codelineno-23-1 href=#__codelineno-23-1></a><span class=c1># Rewrite the class-based signature</span>
</span><span id=__span-23-2><a id=__codelineno-23-2 name=__codelineno-23-2 href=#__codelineno-23-2></a><span class=k>class</span><span class=w> </span><span class=nc>QuestionAnswerInteger</span><span class=p>(</span><span class=n>dspy</span><span class=o>.</span><span class=n>Signature</span><span class=p>)</span> <span class=p>:</span>
</span><span id=__span-23-3><a id=__codelineno-23-3 name=__codelineno-23-3 href=#__codelineno-23-3></a>    <span class=n>question</span> <span class=o>=</span> <span class=n>dspy</span><span class=o>.</span><span class=n>InputField</span><span class=p>(</span><span class=n>desc</span><span class=o>=</span><span class=s2>&quot;Question to be answered&quot;</span><span class=p>)</span> 
</span><span id=__span-23-4><a id=__codelineno-23-4 name=__codelineno-23-4 href=#__codelineno-23-4></a>    <span class=n>answer</span> <span class=o>=</span> <span class=n>dspy</span><span class=o>.</span><span class=n>OutputField</span><span class=p>(</span><span class=n>desc</span><span class=o>=</span><span class=s2>&quot;Integer answer to the question&quot;</span><span class=p>)</span>
</span></code></pre></div> <div class="language-python highlight"><pre><span></span><code><span id=__span-24-1><a id=__codelineno-24-1 name=__codelineno-24-1 href=#__codelineno-24-1></a><span class=n>answer</span> <span class=o>=</span> <span class=n>dspy</span><span class=o>.</span><span class=n>ChainOfThought</span><span class=p>(</span><span class=n>QuestionAnswerInteger</span><span class=p>)</span>
</span><span id=__span-24-2><a id=__codelineno-24-2 name=__codelineno-24-2 href=#__codelineno-24-2></a><span class=n>score</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-24-3><a id=__codelineno-24-3 name=__codelineno-24-3 href=#__codelineno-24-3></a><span class=n>predictions</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-24-4><a id=__codelineno-24-4 name=__codelineno-24-4 href=#__codelineno-24-4></a>
</span><span id=__span-24-5><a id=__codelineno-24-5 name=__codelineno-24-5 href=#__codelineno-24-5></a><span class=c1># Iterate over the data and make predictions over the test dataset</span>
</span><span id=__span-24-6><a id=__codelineno-24-6 name=__codelineno-24-6 href=#__codelineno-24-6></a><span class=k>for</span> <span class=n>example</span> <span class=ow>in</span> <span class=n>test_dataset</span><span class=p>:</span>
</span><span id=__span-24-7><a id=__codelineno-24-7 name=__codelineno-24-7 href=#__codelineno-24-7></a>    <span class=n>pred_answer</span> <span class=o>=</span> <span class=n>answer</span><span class=p>(</span><span class=n>question</span><span class=o>=</span><span class=n>example</span><span class=o>.</span><span class=n>question</span><span class=p>)</span><span class=o>.</span><span class=n>answer</span>
</span><span id=__span-24-8><a id=__codelineno-24-8 name=__codelineno-24-8 href=#__codelineno-24-8></a>    <span class=n>predictions</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>pred_answer</span><span class=p>)</span>
</span><span id=__span-24-9><a id=__codelineno-24-9 name=__codelineno-24-9 href=#__codelineno-24-9></a>    <span class=n>score</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>answer_exact_match</span><span class=p>(</span><span class=n>example</span><span class=o>.</span><span class=n>answer</span><span class=p>,</span> <span class=n>pred_answer</span><span class=p>))</span>
</span><span id=__span-24-10><a id=__codelineno-24-10 name=__codelineno-24-10 href=#__codelineno-24-10></a>
</span><span id=__span-24-11><a id=__codelineno-24-11 name=__codelineno-24-11 href=#__codelineno-24-11></a><span class=c1># Show the score</span>
</span><span id=__span-24-12><a id=__codelineno-24-12 name=__codelineno-24-12 href=#__codelineno-24-12></a><span class=nb>sum</span><span class=p>(</span><span class=n>score</span><span class=p>)</span>
</span></code></pre></div> <div class="language-text highlight"><pre><span></span><code>2
</code></pre></div> <p>With a ChainOfThought pipeline, two good answers out of six were predicted.... The prompt sent to the LLM was already observed in the last section when using the ChainOfThought module.</p> <p>Let's now opimize the parameters (i.e. prompt) with the DSPy optimizer component.</p> <h2 id=optimizer-component>Optimizer component<a class=headerlink href=#optimizer-component title="Permanent link">&para;</a></h2> <p>The optimizer is the component in DSPy that improves the prompt automatically. The optimizer needs to be run over a DSPy program that combines the following components : - A signature &amp; module components - A metric - And a few training inputs</p> <p>In general, to train a machine learning model, we need a lot of data to enhance the model performance. In this case, training data is also needed but since LLMs are already powerful models, starting with only a few observations is possible (e.g. 5-10).</p> <p>Let's take the example above and try to apply an optimizer :</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-25-1><a id=__codelineno-25-1 name=__codelineno-25-1 href=#__codelineno-25-1></a><span class=c1># we import teleprompt because it&#39;s the fromer name of optimizer</span>
</span><span id=__span-25-2><a id=__codelineno-25-2 name=__codelineno-25-2 href=#__codelineno-25-2></a><span class=kn>from</span><span class=w> </span><span class=nn>dspy.teleprompt</span><span class=w> </span><span class=kn>import</span> <span class=o>*</span>
</span></code></pre></div> <div class="language-python highlight"><pre><span></span><code><span id=__span-26-1><a id=__codelineno-26-1 name=__codelineno-26-1 href=#__codelineno-26-1></a><span class=c1># We define the signature</span>
</span><span id=__span-26-2><a id=__codelineno-26-2 name=__codelineno-26-2 href=#__codelineno-26-2></a><span class=k>class</span><span class=w> </span><span class=nc>QuestionAnswerInteger</span><span class=p>(</span><span class=n>dspy</span><span class=o>.</span><span class=n>Signature</span><span class=p>)</span> <span class=p>:</span>
</span><span id=__span-26-3><a id=__codelineno-26-3 name=__codelineno-26-3 href=#__codelineno-26-3></a>    <span class=n>question</span> <span class=o>=</span> <span class=n>dspy</span><span class=o>.</span><span class=n>InputField</span><span class=p>(</span><span class=n>desc</span><span class=o>=</span><span class=s2>&quot;Question to be answered&quot;</span><span class=p>)</span> 
</span><span id=__span-26-4><a id=__codelineno-26-4 name=__codelineno-26-4 href=#__codelineno-26-4></a>    <span class=n>answer</span> <span class=o>=</span> <span class=n>dspy</span><span class=o>.</span><span class=n>OutputField</span><span class=p>(</span><span class=n>desc</span><span class=o>=</span><span class=s2>&quot;Integer answer to the question&quot;</span><span class=p>)</span>
</span></code></pre></div> <div class="language-python highlight"><pre><span></span><code><span id=__span-27-1><a id=__codelineno-27-1 name=__codelineno-27-1 href=#__codelineno-27-1></a><span class=c1># DSPy optimizes programs, so let&#39;s build a chain of thought program for this as it follows :</span>
</span><span id=__span-27-2><a id=__codelineno-27-2 name=__codelineno-27-2 href=#__codelineno-27-2></a><span class=k>class</span><span class=w> </span><span class=nc>COT</span><span class=p>(</span><span class=n>dspy</span><span class=o>.</span><span class=n>Module</span><span class=p>):</span>
</span><span id=__span-27-3><a id=__codelineno-27-3 name=__codelineno-27-3 href=#__codelineno-27-3></a>    <span class=k>def</span><span class=w> </span><span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span><span id=__span-27-4><a id=__codelineno-27-4 name=__codelineno-27-4 href=#__codelineno-27-4></a>        <span class=nb>super</span><span class=p>()</span><span class=o>.</span><span class=fm>__init__</span><span class=p>()</span>
</span><span id=__span-27-5><a id=__codelineno-27-5 name=__codelineno-27-5 href=#__codelineno-27-5></a>
</span><span id=__span-27-6><a id=__codelineno-27-6 name=__codelineno-27-6 href=#__codelineno-27-6></a>        <span class=c1># Define the module</span>
</span><span id=__span-27-7><a id=__codelineno-27-7 name=__codelineno-27-7 href=#__codelineno-27-7></a>        <span class=bp>self</span><span class=o>.</span><span class=n>generate_answer</span> <span class=o>=</span> <span class=n>dspy</span><span class=o>.</span><span class=n>ChainOfThought</span><span class=p>(</span><span class=n>QuestionAnswerInteger</span><span class=p>)</span>
</span><span id=__span-27-8><a id=__codelineno-27-8 name=__codelineno-27-8 href=#__codelineno-27-8></a>
</span><span id=__span-27-9><a id=__codelineno-27-9 name=__codelineno-27-9 href=#__codelineno-27-9></a>    <span class=k>def</span><span class=w> </span><span class=nf>forward</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>question</span><span class=p>):</span>
</span><span id=__span-27-10><a id=__codelineno-27-10 name=__codelineno-27-10 href=#__codelineno-27-10></a>        <span class=n>prediction</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>generate_answer</span><span class=p>(</span><span class=n>question</span><span class=o>=</span><span class=n>question</span><span class=p>)</span>
</span><span id=__span-27-11><a id=__codelineno-27-11 name=__codelineno-27-11 href=#__codelineno-27-11></a>        <span class=k>return</span> <span class=n>dspy</span><span class=o>.</span><span class=n>Prediction</span><span class=p>(</span><span class=n>answer</span><span class=o>=</span><span class=n>prediction</span><span class=o>.</span><span class=n>answer</span><span class=p>)</span>
</span></code></pre></div> <p>DSPy provides several optimizers that apply different techniques, for example : - LabeledFewShots : It utilizes the COT prompt and supplements it with a few example demonstration. - COPRO : It optimizes the full COT prompt. - BotstrapFewShot : It self-generates complete demonstrations - <a href=https://dspy-docs.vercel.app/docs/building-blocks/optimizers#what-dspy-optimizers-are-currently-available>More here</a></p> <p>Let's focus on the <code>BootstrapFewShot</code> optimizer. This optimizer is known for working well with a few examples. This optimizers is said to « self-generate complete demonstrations for every stage of your program ». What does that mean ? </p> <p>The COT (our current program, it may change for others) prompt generates a "reasoning" part, however the current examples in the training set don't provide this "reasoning" part. So, for each question in the training data, this optimizer generates a "reasoning" before building the few shot prompt. How ? By calling the LLM for each example...<br> Here, this method can be seen as a few shot prompting technique but adapted to the program.</p> <p>The best way to understand this part is by looking at the prompt:</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-28-1><a id=__codelineno-28-1 name=__codelineno-28-1 href=#__codelineno-28-1></a><span class=c1># Here we use the &quot;answer_exact_match&quot; metric from DSPy</span>
</span><span id=__span-28-2><a id=__codelineno-28-2 name=__codelineno-28-2 href=#__codelineno-28-2></a><span class=n>optimizer</span> <span class=o>=</span> <span class=n>BootstrapFewShot</span><span class=p>(</span><span class=n>metric</span><span class=o>=</span><span class=n>dspy</span><span class=o>.</span><span class=n>evaluate</span><span class=o>.</span><span class=n>metrics</span><span class=o>.</span><span class=n>answer_exact_match</span><span class=p>,</span> <span class=n>max_bootstrapped_demos</span><span class=o>=</span><span class=mi>5</span><span class=p>,</span> <span class=n>max_labeled_demos</span><span class=o>=</span><span class=mi>3</span><span class=p>)</span>
</span></code></pre></div> <div class="language-python highlight"><pre><span></span><code><span id=__span-29-1><a id=__codelineno-29-1 name=__codelineno-29-1 href=#__codelineno-29-1></a><span class=c1># We compile the program with the optimizer</span>
</span><span id=__span-29-2><a id=__codelineno-29-2 name=__codelineno-29-2 href=#__codelineno-29-2></a><span class=n>optimized_program</span> <span class=o>=</span> <span class=n>optimizer</span><span class=o>.</span><span class=n>compile</span><span class=p>(</span><span class=n>COT</span><span class=p>(),</span> <span class=n>trainset</span><span class=o>=</span><span class=n>train_dataset</span><span class=p>)</span>
</span></code></pre></div> <div class="language-text highlight"><pre><span></span><code>100%|██████████| 6/6 [00:05&lt;00:00,  1.10it/s]

Bootstrapped 4 full traces after 6 examples in round 0.
</code></pre></div> <p>Since there are 6 observations inside the training set, the model is called 6 times. As said before, for each example it tries to generate the reasoning part...</p> <p>The first call appears as follows: <div class="language-python highlight"><pre><span></span><code><span id=__span-30-1><a id=__codelineno-30-1 name=__codelineno-30-1 href=#__codelineno-30-1></a><span class=c1># The prompt : </span>
</span><span id=__span-30-2><a id=__codelineno-30-2 name=__codelineno-30-2 href=#__codelineno-30-2></a>
</span><span id=__span-30-3><a id=__codelineno-30-3 name=__codelineno-30-3 href=#__codelineno-30-3></a><span class=sd>&quot;&quot;&quot;</span>
</span><span id=__span-30-4><a id=__codelineno-30-4 name=__codelineno-30-4 href=#__codelineno-30-4></a><span class=sd>&quot;Given the fields `question`, produce the fields `answer`. </span>
</span><span id=__span-30-5><a id=__codelineno-30-5 name=__codelineno-30-5 href=#__codelineno-30-5></a><span class=sd>--- </span>
</span><span id=__span-30-6><a id=__codelineno-30-6 name=__codelineno-30-6 href=#__codelineno-30-6></a><span class=sd>Follow the following format. Question: Question to be answered Reasoning: Let&#39;s think step by step in order to ${produce the answer}. We ... Answer: Integer answer to the question </span>
</span><span id=__span-30-7><a id=__codelineno-30-7 name=__codelineno-30-7 href=#__codelineno-30-7></a><span class=sd>--- </span>
</span><span id=__span-30-8><a id=__codelineno-30-8 name=__codelineno-30-8 href=#__codelineno-30-8></a><span class=sd>Question: If a doctor gives you 4 pills and tells you to take one pill every half hour, how long would the pills last? Answer: 2 </span>
</span><span id=__span-30-9><a id=__codelineno-30-9 name=__codelineno-30-9 href=#__codelineno-30-9></a><span class=sd>--- </span>
</span><span id=__span-30-10><a id=__codelineno-30-10 name=__codelineno-30-10 href=#__codelineno-30-10></a><span class=sd>Question: How many times can you subtract 5 from 25? Answer: 5 </span>
</span><span id=__span-30-11><a id=__codelineno-30-11 name=__codelineno-30-11 href=#__codelineno-30-11></a><span class=sd>--- </span>
</span><span id=__span-30-12><a id=__codelineno-30-12 name=__codelineno-30-12 href=#__codelineno-30-12></a><span class=sd>Question: If there are 12 fish and half of them drown, how many are left? Reasoning: Let&#39;s think step by step in order to&quot;</span>
</span><span id=__span-30-13><a id=__codelineno-30-13 name=__codelineno-30-13 href=#__codelineno-30-13></a><span class=sd>&quot;&quot;&quot;</span>
</span><span id=__span-30-14><a id=__codelineno-30-14 name=__codelineno-30-14 href=#__codelineno-30-14></a>
</span><span id=__span-30-15><a id=__codelineno-30-15 name=__codelineno-30-15 href=#__codelineno-30-15></a><span class=c1># The answer : </span>
</span><span id=__span-30-16><a id=__codelineno-30-16 name=__codelineno-30-16 href=#__codelineno-30-16></a>
</span><span id=__span-30-17><a id=__codelineno-30-17 name=__codelineno-30-17 href=#__codelineno-30-17></a><span class=sd>&quot;&quot;&quot;</span>
</span><span id=__span-30-18><a id=__codelineno-30-18 name=__codelineno-30-18 href=#__codelineno-30-18></a><span class=sd>produce the answer. We start with 12 fish, and if half of them drown, that means 6 fish are left. Answer: 6</span>
</span><span id=__span-30-19><a id=__codelineno-30-19 name=__codelineno-30-19 href=#__codelineno-30-19></a><span class=sd>&quot;&quot;&quot;</span>
</span></code></pre></div></p> <p>It begins as the usual COT prompt and then, the optimizer uses a few shot prompting technique (with two examples from the training set) to generate the reasoning part for the following question.: - Question: If there are 12 fish and half of them drown, how many are left?</p> <p>The answer is incorrect. Therefore, it can be assumed that the reasoning has failed and this question won't be used inside the final prompt part since the reasoning failed.</p> <p>The seconde one : </p> <div class="language-python highlight"><pre><span></span><code><span id=__span-31-1><a id=__codelineno-31-1 name=__codelineno-31-1 href=#__codelineno-31-1></a><span class=c1># The prompt : </span>
</span><span id=__span-31-2><a id=__codelineno-31-2 name=__codelineno-31-2 href=#__codelineno-31-2></a>
</span><span id=__span-31-3><a id=__codelineno-31-3 name=__codelineno-31-3 href=#__codelineno-31-3></a><span class=sd>&quot;&quot;&quot;</span>
</span><span id=__span-31-4><a id=__codelineno-31-4 name=__codelineno-31-4 href=#__codelineno-31-4></a><span class=sd>Given the fields `question`, produce the fields `answer`. </span>
</span><span id=__span-31-5><a id=__codelineno-31-5 name=__codelineno-31-5 href=#__codelineno-31-5></a><span class=sd>--- </span>
</span><span id=__span-31-6><a id=__codelineno-31-6 name=__codelineno-31-6 href=#__codelineno-31-6></a><span class=sd>Follow the following format. Question: Question to be answered Reasoning: Let&#39;s think step by step in order to ${produce the answer}. We ... Answer: Integer answer to the question </span>
</span><span id=__span-31-7><a id=__codelineno-31-7 name=__codelineno-31-7 href=#__codelineno-31-7></a><span class=sd>--- </span>
</span><span id=__span-31-8><a id=__codelineno-31-8 name=__codelineno-31-8 href=#__codelineno-31-8></a><span class=sd>Question: If a doctor gives you 4 pills and tells you to take one pill every half hour, how long would the pills last? Answer: 2 </span>
</span><span id=__span-31-9><a id=__codelineno-31-9 name=__codelineno-31-9 href=#__codelineno-31-9></a><span class=sd>--- </span>
</span><span id=__span-31-10><a id=__codelineno-31-10 name=__codelineno-31-10 href=#__codelineno-31-10></a><span class=sd>Question: How many times can you subtract 5 from 25? Answer: 5 </span>
</span><span id=__span-31-11><a id=__codelineno-31-11 name=__codelineno-31-11 href=#__codelineno-31-11></a><span class=sd>--- </span>
</span><span id=__span-31-12><a id=__codelineno-31-12 name=__codelineno-31-12 href=#__codelineno-31-12></a><span class=sd>Question: If there are 12 fish and half of them drown, how many are left? Answer: 12 </span>
</span><span id=__span-31-13><a id=__codelineno-31-13 name=__codelineno-31-13 href=#__codelineno-31-13></a><span class=sd>--- </span>
</span><span id=__span-31-14><a id=__codelineno-31-14 name=__codelineno-31-14 href=#__codelineno-31-14></a><span class=sd>Question: A farmer has 17 sheep, and all but 9 die. How many are left? Reasoning: Let&#39;s think step by step in order to</span>
</span><span id=__span-31-15><a id=__codelineno-31-15 name=__codelineno-31-15 href=#__codelineno-31-15></a><span class=sd>&quot;&quot;&quot;</span>
</span><span id=__span-31-16><a id=__codelineno-31-16 name=__codelineno-31-16 href=#__codelineno-31-16></a>
</span><span id=__span-31-17><a id=__codelineno-31-17 name=__codelineno-31-17 href=#__codelineno-31-17></a><span class=c1># The answer : </span>
</span><span id=__span-31-18><a id=__codelineno-31-18 name=__codelineno-31-18 href=#__codelineno-31-18></a><span class=sd>&quot;&quot;&quot;</span>
</span><span id=__span-31-19><a id=__codelineno-31-19 name=__codelineno-31-19 href=#__codelineno-31-19></a><span class=sd>produce the answer. We start with 17 sheep and then subtract 9 from the total. Answer: 9</span>
</span><span id=__span-31-20><a id=__codelineno-31-20 name=__codelineno-31-20 href=#__codelineno-31-20></a><span class=sd>&quot;&quot;&quot;</span>
</span></code></pre></div> <p>Good answer for this one. It can be assumed that the reasoning succeeded.</p> <p>The third one : <div class="language-python highlight"><pre><span></span><code><span id=__span-32-1><a id=__codelineno-32-1 name=__codelineno-32-1 href=#__codelineno-32-1></a><span class=c1># The prompt : </span>
</span><span id=__span-32-2><a id=__codelineno-32-2 name=__codelineno-32-2 href=#__codelineno-32-2></a>
</span><span id=__span-32-3><a id=__codelineno-32-3 name=__codelineno-32-3 href=#__codelineno-32-3></a><span class=sd>&quot;&quot;&quot;</span>
</span><span id=__span-32-4><a id=__codelineno-32-4 name=__codelineno-32-4 href=#__codelineno-32-4></a><span class=sd>Given the fields `question`, produce the fields `answer`. </span>
</span><span id=__span-32-5><a id=__codelineno-32-5 name=__codelineno-32-5 href=#__codelineno-32-5></a><span class=sd>--- </span>
</span><span id=__span-32-6><a id=__codelineno-32-6 name=__codelineno-32-6 href=#__codelineno-32-6></a><span class=sd>Follow the following format. Question: Question to be answered Reasoning: Let&#39;s think step by step in order to ${produce the answer}. We ... Answer: Integer answer to the question </span>
</span><span id=__span-32-7><a id=__codelineno-32-7 name=__codelineno-32-7 href=#__codelineno-32-7></a><span class=sd>--- </span>
</span><span id=__span-32-8><a id=__codelineno-32-8 name=__codelineno-32-8 href=#__codelineno-32-8></a><span class=sd>Question: If a doctor gives you 4 pills and tells you to take one pill every half hour, how long would the pills last? Answer: 2 </span>
</span><span id=__span-32-9><a id=__codelineno-32-9 name=__codelineno-32-9 href=#__codelineno-32-9></a><span class=sd>--- </span>
</span><span id=__span-32-10><a id=__codelineno-32-10 name=__codelineno-32-10 href=#__codelineno-32-10></a><span class=sd>Question: How many times can you subtract 5 from 25? Answer: 5 </span>
</span><span id=__span-32-11><a id=__codelineno-32-11 name=__codelineno-32-11 href=#__codelineno-32-11></a><span class=sd>--- </span>
</span><span id=__span-32-12><a id=__codelineno-32-12 name=__codelineno-32-12 href=#__codelineno-32-12></a><span class=sd>Question: If there are 12 fish and half of them drown, how many are left? Answer: 12 </span>
</span><span id=__span-32-13><a id=__codelineno-32-13 name=__codelineno-32-13 href=#__codelineno-32-13></a><span class=sd>--- </span>
</span><span id=__span-32-14><a id=__codelineno-32-14 name=__codelineno-32-14 href=#__codelineno-32-14></a><span class=sd>Question: If you toss a coin 3 times, how many different possible outcomes are there? Reasoning: Let&#39;s think step by step in order to</span>
</span><span id=__span-32-15><a id=__codelineno-32-15 name=__codelineno-32-15 href=#__codelineno-32-15></a><span class=sd>&quot;&quot;&quot;</span>
</span><span id=__span-32-16><a id=__codelineno-32-16 name=__codelineno-32-16 href=#__codelineno-32-16></a><span class=c1># The answer : </span>
</span><span id=__span-32-17><a id=__codelineno-32-17 name=__codelineno-32-17 href=#__codelineno-32-17></a>
</span><span id=__span-32-18><a id=__codelineno-32-18 name=__codelineno-32-18 href=#__codelineno-32-18></a><span class=sd>&quot;&quot;&quot;</span>
</span><span id=__span-32-19><a id=__codelineno-32-19 name=__codelineno-32-19 href=#__codelineno-32-19></a><span class=sd>produce the answer. We can use the formula 2^n, where n is the number of times the coin is tossed. Answer: 8</span>
</span><span id=__span-32-20><a id=__codelineno-32-20 name=__codelineno-32-20 href=#__codelineno-32-20></a><span class=sd>&quot;&quot;&quot;</span>
</span></code></pre></div> Good answer as well ! </p> <p>Well, it continues until iterating through the 6 examples. Each time there is the classic prompt with the signature, and some few shots examples (i.e. the parameter <code>max_labeled_demos</code> was set to 3, that's why sometime there are 2 or 3 examples inside the prompt).</p> <p>For each iteration, an answer is generated and if the answer is correct (for the defined metric), the full example with the reasoning part here (since the COT is being used) is included inside the final prompt: </p> <p>The final prompt looks as follows: : </p> <div class="language-python highlight"><pre><span></span><code><span id=__span-33-1><a id=__codelineno-33-1 name=__codelineno-33-1 href=#__codelineno-33-1></a><span class=c1># Final prompt : </span>
</span><span id=__span-33-2><a id=__codelineno-33-2 name=__codelineno-33-2 href=#__codelineno-33-2></a>
</span><span id=__span-33-3><a id=__codelineno-33-3 name=__codelineno-33-3 href=#__codelineno-33-3></a><span class=sd>&quot;&quot;&quot;</span>
</span><span id=__span-33-4><a id=__codelineno-33-4 name=__codelineno-33-4 href=#__codelineno-33-4></a><span class=sd>Given the fields `question`, produce the fields `answer`. </span>
</span><span id=__span-33-5><a id=__codelineno-33-5 name=__codelineno-33-5 href=#__codelineno-33-5></a><span class=sd>--- </span>
</span><span id=__span-33-6><a id=__codelineno-33-6 name=__codelineno-33-6 href=#__codelineno-33-6></a><span class=sd>Follow the following format. Question: Question to be answered Reasoning: Let&#39;s think step by step in order to ${produce the answer}. We ... Answer: Integer answer to the question </span>
</span><span id=__span-33-7><a id=__codelineno-33-7 name=__codelineno-33-7 href=#__codelineno-33-7></a><span class=sd>--- </span>
</span><span id=__span-33-8><a id=__codelineno-33-8 name=__codelineno-33-8 href=#__codelineno-33-8></a><span class=sd>Question: A farmer has 17 sheep, and all but 9 die. How many are left? Reasoning: Let&#39;s think step by step in order to produce the answer. We start with 17 sheep and then subtract 9 from the total. Answer: 9 </span>
</span><span id=__span-33-9><a id=__codelineno-33-9 name=__codelineno-33-9 href=#__codelineno-33-9></a><span class=sd>--- </span>
</span><span id=__span-33-10><a id=__codelineno-33-10 name=__codelineno-33-10 href=#__codelineno-33-10></a><span class=sd>Question: If you toss a coin 3 times, how many different possible outcomes are there? Reasoning: Let&#39;s think step by step in order to produce the answer. We can use the formula 2^n, where n is the number of times the coin is tossed. Answer: 8 </span>
</span><span id=__span-33-11><a id=__codelineno-33-11 name=__codelineno-33-11 href=#__codelineno-33-11></a><span class=sd>--- </span>
</span><span id=__span-33-12><a id=__codelineno-33-12 name=__codelineno-33-12 href=#__codelineno-33-12></a><span class=sd>Question: How many times does the digit 5 appear in the numbers from 1 to 100? Reasoning: Let&#39;s think step by step in order to produce the answer. We can count the number of times the digit 5 appears in the units place, the tens place, and the hundreds place for each number from 1 to 100. Answer: 20 </span>
</span><span id=__span-33-13><a id=__codelineno-33-13 name=__codelineno-33-13 href=#__codelineno-33-13></a><span class=sd>--- </span>
</span><span id=__span-33-14><a id=__codelineno-33-14 name=__codelineno-33-14 href=#__codelineno-33-14></a><span class=sd>Question: How many times can you subtract 5 from 25? Reasoning: Let&#39;s think step by step in order to produce the answer. We start with 25 and subtract 5, leaving 20. Then we can subtract 5 again, leaving 15. We can continue this process until we reach 0. Answer: 5 </span>
</span><span id=__span-33-15><a id=__codelineno-33-15 name=__codelineno-33-15 href=#__codelineno-33-15></a><span class=sd>--- </span>
</span><span id=__span-33-16><a id=__codelineno-33-16 name=__codelineno-33-16 href=#__codelineno-33-16></a><span class=sd>Question: When Chris was 6 years old his sister was half his age. Now chris is 20 how old his sister is now ? Reasoning: Let&#39;s think step by step in order to</span>
</span><span id=__span-33-17><a id=__codelineno-33-17 name=__codelineno-33-17 href=#__codelineno-33-17></a><span class=sd>&quot;&quot;&quot;</span>
</span></code></pre></div> <p>The final prompt contains 4 bootstrapped examples (i.e. parameter <code>max_bootstrapped_demos</code>). So the optimizer builds a full "demonstration" for each example in the training set =&gt; an example with the reasoning part, to adapt these examples to the current program.</p> <p>One of the nice points about DSPy is its ability to iterate very fast in order to improve the prompt. And since the prompt may be very sensitive while building complex applications, this could be very helpful.</p> <p>Let's test the optimized program:</p> <div class="language-python highlight"><pre><span></span><code><span id=__span-34-1><a id=__codelineno-34-1 name=__codelineno-34-1 href=#__codelineno-34-1></a><span class=n>score</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-34-2><a id=__codelineno-34-2 name=__codelineno-34-2 href=#__codelineno-34-2></a><span class=n>predictions</span> <span class=o>=</span> <span class=p>[]</span>
</span><span id=__span-34-3><a id=__codelineno-34-3 name=__codelineno-34-3 href=#__codelineno-34-3></a>
</span><span id=__span-34-4><a id=__codelineno-34-4 name=__codelineno-34-4 href=#__codelineno-34-4></a><span class=c1># Iterate over the test data and make predictions</span>
</span><span id=__span-34-5><a id=__codelineno-34-5 name=__codelineno-34-5 href=#__codelineno-34-5></a><span class=k>for</span> <span class=n>example</span> <span class=ow>in</span> <span class=n>test_dataset</span><span class=p>:</span>
</span><span id=__span-34-6><a id=__codelineno-34-6 name=__codelineno-34-6 href=#__codelineno-34-6></a>    <span class=n>pred_answer</span> <span class=o>=</span> <span class=n>optimized_program</span><span class=p>(</span><span class=n>question</span><span class=o>=</span><span class=n>example</span><span class=o>.</span><span class=n>question</span><span class=p>)</span><span class=o>.</span><span class=n>answer</span>
</span><span id=__span-34-7><a id=__codelineno-34-7 name=__codelineno-34-7 href=#__codelineno-34-7></a>    <span class=n>predictions</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>pred_answer</span><span class=p>)</span>
</span><span id=__span-34-8><a id=__codelineno-34-8 name=__codelineno-34-8 href=#__codelineno-34-8></a>    <span class=n>score</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>answer_exact_match</span><span class=p>(</span><span class=n>example</span><span class=o>.</span><span class=n>answer</span><span class=p>,</span> <span class=n>pred_answer</span><span class=p>))</span>
</span><span id=__span-34-9><a id=__codelineno-34-9 name=__codelineno-34-9 href=#__codelineno-34-9></a>
</span><span id=__span-34-10><a id=__codelineno-34-10 name=__codelineno-34-10 href=#__codelineno-34-10></a><span class=c1># Show the score</span>
</span><span id=__span-34-11><a id=__codelineno-34-11 name=__codelineno-34-11 href=#__codelineno-34-11></a><span class=nb>sum</span><span class=p>(</span><span class=n>score</span><span class=p>)</span>
</span></code></pre></div> <div class="language-text highlight"><pre><span></span><code>3
</code></pre></div> <p>Well well well, it went from 2 over 6 to 3 over 6, nothing exceptional in this example 😅 This program is very basic, improvements can continue but the idea is to gain a first understanding of what DSPy does under the hood to help optimize LLMs programs. To truly evaluate this framework, testing it over more complex programs like RAG applications or agent-based apps could be done... 😀</p> <p>That's it ! Thanks for reading ! </p> <p>I would love to hear from you if you found this post useful or you have any observation 😀 : <a href=mailto:anas0rabhi@gmail.com>&#97;&#110;&#97;&#115;&#48;&#114;&#97;&#98;&#104;&#105;&#64;&#103;&#109;&#97;&#105;&#108;&#46;&#99;&#111;&#109;</a> </p> </article> </div> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg> Back to top </button> </main> <footer class=md-footer> <nav class="md-footer__inner md-grid" aria-label=Footer> <a href=../../../02/25/new-frameworks-of-generative-ai/ class="md-footer__link md-footer__link--prev" aria-label="Previous: New frameworks of Generative AI"> <div class="md-footer__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg> </div> <div class=md-footer__title> <span class=md-footer__direction> Previous </span> <div class=md-ellipsis> New frameworks of Generative AI </div> </div> </a> </nav> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2024 - 2025 Anas Rabhi </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/anas-rabhi target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg> </a> <a href=https://x.com/anas9r target=_blank rel=noopener title=x.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M357.2 48h70.6L273.6 224.2 455 464H313L201.7 318.6 74.5 464H3.8l164.9-188.5L-5.2 48h145.6l100.5 132.9zm-24.8 373.8h39.1L119.1 88h-42z"/></svg> </a> <a href=https://www.linkedin.com/in/anasrabhi/ target=_blank rel=noopener title=www.linkedin.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><!-- Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77m282.1 320h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"annotate": null, "base": "../../../../..", "features": ["announce.dismiss", "content.action.edit", "content.action.view", "content.code.annotate", "content.code.copy", "content.tooltips", "navigation.footer", "navigation.indexes", "navigation.sections", "navigation.tabs", "navigation.top", "navigation.tracking", "search.highlight", "search.share", "search.suggest", "toc.follow"], "search": "../../../../../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script> <script src=../../../../../assets/javascripts/bundle.79ae519e.min.js></script> </body> </html>